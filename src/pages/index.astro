---
import { fetchProfile } from '../lib/github'

import DefaultLayout from '../layouts/Default.astro'

import Greeting from '../sections/Greeting.astro'
import Profile from '../sections/Profile.astro'
import Projects from '../sections/Projects.astro'
import Skills from '../sections/Skills.astro'

import { getSecret } from 'astro:env/server';

const { env } = Astro.locals.runtime;

const ghUsername = env.GITHUB_USERNAME
const ghToken = getSecret("GITHUB_TOKEN") ?? ""

const ghProfile = await fetchProfile(ghUsername, ghToken)

const openGraphImg = '/portfolio-greeting.png'
---

<DefaultLayout title="Emilio Gozo" openGraph={{ image: openGraphImg }}>
  <Greeting />
  <Skills />
  {ghProfile && <Projects prof={ghProfile} />}
  {ghProfile && <Profile prof={ghProfile} />}
</DefaultLayout>
